<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Activity Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
        }

        .config-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }

        .input-group input {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .fetch-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .fetch-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .fetch-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
        }

        .platform-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .activity-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
        }

        .activity-item {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            transition: background-color 0.2s ease;
        }

        .activity-item:hover {
            background-color: rgba(102, 126, 234, 0.05);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-type {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-right: 10px;
            min-width: 80px;
            text-align: center;
        }

        .activity-description {
            flex: 1;
            font-size: 0.9rem;
            color: #555;
        }

        .activity-time {
            font-size: 0.8rem;
            color: #888;
            margin-left: 10px;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .combined-chart {
            grid-column: 1 / -1;
        }

        .activity-heatmap {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            margin-top: 15px;
        }

        .heatmap-day {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            background: #eee;
            transition: all 0.2s ease;
        }

        .heatmap-day.active-1 { background: #c6e48b; }
        .heatmap-day.active-2 { background: #7bc96f; }
        .heatmap-day.active-3 { background: #239a3b; }
        .heatmap-day.active-4 { background: #196127; }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .config-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 Git Activity Dashboard</h1>
            <p>Track your development activity across GitLab and GitHub</p>
        </div>

        <div class="config-section">
            <h2 style="margin-bottom: 20px; color: #333;">Configuration</h2>
            <div class="config-grid">
                <div class="input-group">
                    <label for="githubUsername">GitHub Username</label>
                    <input type="text" id="githubUsername" placeholder="Enter GitHub username">
                </div>
                <div class="input-group">
                    <label for="githubToken">GitHub Token (optional)</label>
                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx">
                </div>
                <div class="input-group">
                    <label for="gitlabUsername">GitLab Username</label>
                    <input type="text" id="gitlabUsername" placeholder="Enter GitLab username">
                </div>
                <div class="input-group">
                    <label for="gitlabToken">GitLab Token (optional)</label>
                    <input type="password" id="gitlabToken" placeholder="glpat-xxxxxxxxxxxx">
                </div>
                <div class="input-group">
                    <label for="gitlabInstance">GitLab Instance URL</label>
                    <input type="text" id="gitlabInstance" placeholder="https://gitlab.com" value="https://gitlab.com">
                </div>
            </div>
            <button class="fetch-btn" onclick="fetchAllData()">
                <span id="fetchBtnText">🔄 Fetch Activity Data</span>
            </button>
        </div>

        <div id="dashboardContent" style="display: none;">
            <div class="dashboard-grid">
                <div class="card">
                    <h3>
                        <svg class="platform-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                        GitHub Activity
                    </h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-number" id="githubCommits">0</span>
                            <span class="stat-label">Commits</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="githubRepos">0</span>
                            <span class="stat-label">Repositories</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="githubFollowers">0</span>
                            <span class="stat-label">Followers</span>
                        </div>
                    </div>
                    <div class="activity-list" id="githubActivity"></div>
                    <div class="chart-container">
                        <canvas id="githubChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3>
                        <svg class="platform-icon" viewBox="0 0 24 24" fill="#FC6D26">
                            <path d="m23.6004 9.5927-.0337-.0862L20.3.9814a.851.851 0 0 0-.3362-.405.8748.8748 0 0 0-.9997.0539.8748.8748 0 0 0-.29.4399L16.2805 7.1054H7.7195L5.3654 1.0814a.8748.8748 0 0 0-.29-.4399.8748.8748 0 0 0-.9997-.0539.851.851 0 0 0-.3362.405L.1331 9.5065l-.0337.0862a6.0814 6.0814 0 0 0 2.0112 7.0062L12.0004 24l9.8892-7.4071A6.0814 6.0814 0 0 0 23.6004 9.5927Z"/>
                        </svg>
                        GitLab Activity
                    </h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-number" id="gitlabCommits">0</span>
                            <span class="stat-label">Commits</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="gitlabProjects">0</span>
                            <span class="stat-label">Projects</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="gitlabMRs">0</span>
                            <span class="stat-label">Merge Requests</span>
                        </div>
                    </div>
                    <div class="activity-list" id="gitlabActivity"></div>
                    <div class="chart-container">
                        <canvas id="gitlabChart"></canvas>
                    </div>
                </div>

                <div class="card combined-chart">
                    <h3>📊 Combined Activity Overview</h3>
                    <div class="chart-container">
                        <canvas id="combinedChart"></canvas>
                    </div>
                    <div class="activity-heatmap" id="activityHeatmap"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let githubData = {};
        let gitlabData = {};
        let charts = {};

        async function fetchAllData() {
            const fetchBtn = document.getElementById('fetchBtnText');
            const originalText = fetchBtn.textContent;
            fetchBtn.textContent = '⏳ Fetching data...';
            document.querySelector('.fetch-btn').disabled = true;

            try {
                await Promise.all([
                    fetchGitHubData(),
                    fetchGitLabData()
                ]);
                
                displayDashboard();
                document.getElementById('dashboardContent').style.display = 'block';
            } catch (error) {
                console.error('Error fetching data:', error);
                showError('Failed to fetch data. Please check your configuration and try again.');
            } finally {
                fetchBtn.textContent = originalText;
                document.querySelector('.fetch-btn').disabled = false;
            }
        }

        async function fetchGitHubData() {
            const username = document.getElementById('githubUsername').value.trim();
            const token = document.getElementById('githubToken').value.trim();
            
            if (!username) return;

            const headers = {
                'Accept': 'application/vnd.github.v3+json',
                'User-Agent': 'GitActivity-Dashboard'
            };
            
            if (token) {
                headers['Authorization'] = `token ${token}`;
            }

            try {
                // Fetch user info
                const userResponse = await fetch(`https://api.github.com/users/${username}`, { headers });
                const userData = await userResponse.json();

                // Fetch repositories
                const reposResponse = await fetch(`https://api.github.com/users/${username}/repos?per_page=100&sort=updated`, { headers });
                const reposData = await reposResponse.json();

                // Fetch events
                const eventsResponse = await fetch(`https://api.github.com/users/${username}/events?per_page=100`, { headers });
                const eventsData = await eventsResponse.json();

                githubData = {
                    user: userData,
                    repos: Array.isArray(reposData) ? reposData : [],
                    events: Array.isArray(eventsData) ? eventsData : []
                };

                updateGitHubStats();
                updateGitHubActivity();
                createGitHubChart();
            } catch (error) {
                console.error('GitHub API Error:', error);
                showError('GitHub API error. Check your username and token.');
            }
        }

        async function fetchGitLabData() {
            const username = document.getElementById('gitlabUsername').value.trim();
            const token = document.getElementById('gitlabToken').value.trim();
            const instance = document.getElementById('gitlabInstance').value.trim() || 'https://gitlab.com';
            
            if (!username) return;

            const headers = {
                'Content-Type': 'application/json'
            };
            
            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            try {
                // Fetch user info
                const userResponse = await fetch(`${instance}/api/v4/users?username=${username}`, { headers });
                const userData = await userResponse.json();
                const user = userData[0];

                if (!user) {
                    throw new Error('User not found');
                }

                // Fetch user's projects
                const projectsResponse = await fetch(`${instance}/api/v4/users/${user.id}/projects?per_page=100`, { headers });
                const projectsData = await projectsResponse.json();

                // Fetch user events
                const eventsResponse = await fetch(`${instance}/api/v4/users/${user.id}/events?per_page=100`, { headers });
                const eventsData = await eventsResponse.json();

                gitlabData = {
                    user: user,
                    projects: Array.isArray(projectsData) ? projectsData : [],
                    events: Array.isArray(eventsData) ? eventsData : []
                };

                updateGitLabStats();
                updateGitLabActivity();
                createGitLabChart();
            } catch (error) {
                console.error('GitLab API Error:', error);
                showError('GitLab API error. Check your username, token, and instance URL.');
            }
        }

        function updateGitHubStats() {
            const commits = githubData.events?.filter(event => event.type === 'PushEvent').length || 0;
            const repos = githubData.repos?.length || 0;
            const followers = githubData.user?.followers || 0;

            document.getElementById('githubCommits').textContent = commits;
            document.getElementById('githubRepos').textContent = repos;
            document.getElementById('githubFollowers').textContent = followers;
        }

        function updateGitLabStats() {
            const events = gitlabData.events || [];
            const commits = events.filter(event => event.action_name === 'pushed to').length;
            const projects = gitlabData.projects?.length || 0;
            const mrs = events.filter(event => event.target_type === 'MergeRequest').length;

            document.getElementById('gitlabCommits').textContent = commits;
            document.getElementById('gitlabProjects').textContent = projects;
            document.getElementById('gitlabMRs').textContent = mrs;
        }

        function updateGitHubActivity() {
            const container = document.getElementById('githubActivity');
            const events = githubData.events?.slice(0, 10) || [];

            container.innerHTML = events.map(event => {
                const date = new Date(event.created_at).toLocaleDateString();
                const type = event.type.replace('Event', '');
                
                let description = `${event.repo.name}`;
                if (event.type === 'PushEvent') {
                    description = `Pushed ${event.payload.commits?.length || 0} commits to ${event.repo.name}`;
                } else if (event.type === 'CreateEvent') {
                    description = `Created ${event.payload.ref_type} in ${event.repo.name}`;
                } else if (event.type === 'IssuesEvent') {
                    description = `${event.payload.action} issue in ${event.repo.name}`;
                }

                return `
                    <div class="activity-item">
                        <span class="activity-type">${type}</span>
                        <span class="activity-description">${description}</span>
                        <span class="activity-time">${date}</span>
                    </div>
                `;
            }).join('');
        }

        function updateGitLabActivity() {
            const container = document.getElementById('gitlabActivity');
            const events = gitlabData.events?.slice(0, 10) || [];

            container.innerHTML = events.map(event => {
                const date = new Date(event.created_at).toLocaleDateString();
                const type = event.action_name || 'Activity';
                
                let description = event.target_title || event.push_data?.commit_title || 'GitLab activity';
                if (event.project_id) {
                    const project = gitlabData.projects?.find(p => p.id === event.project_id);
                    if (project) {
                        description += ` in ${project.name}`;
                    }
                }

                return `
                    <div class="activity-item">
                        <span class="activity-type">${type}</span>
                        <span class="activity-description">${description}</span>
                        <span class="activity-time">${date}</span>
                    </div>
                `;
            }).join('');
        }

        function createGitHubChart() {
            const ctx = document.getElementById('githubChart').getContext('2d');
            const events = githubData.events || [];
            
            // Group events by date
            const dailyActivity = {};
            events.forEach(event => {
                const date = new Date(event.created_at).toDateString();
                dailyActivity[date] = (dailyActivity[date] || 0) + 1;
            });

            const labels = Object.keys(dailyActivity).slice(-7);
            const data = labels.map(date => dailyActivity[date]);

            if (charts.github) {
                charts.github.destroy();
            }

            charts.github = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'GitHub Activity',
                        data: data,
                        borderColor: '#333',
                        backgroundColor: 'rgba(51, 51, 51, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createGitLabChart() {
            const ctx = document.getElementById('gitlabChart').getContext('2d');
            const events = gitlabData.events || [];
            
            // Group events by date
            const dailyActivity = {};
            events.forEach(event => {
                const date = new Date(event.created_at).toDateString();
                dailyActivity[date] = (dailyActivity[date] || 0) + 1;
            });

            const labels = Object.keys(dailyActivity).slice(-7);
            const data = labels.map(date => dailyActivity[date]);

            if (charts.gitlab) {
                charts.gitlab.destroy();
            }

            charts.gitlab = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'GitLab Activity',
                        data: data,
                        backgroundColor: '#FC6D26',
                        borderColor: '#FC6D26',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function displayDashboard() {
            createCombinedChart();
            createActivityHeatmap();
        }

        function createCombinedChart() {
            const ctx = document.getElementById('combinedChart').getContext('2d');
            
            // Combine GitHub and GitLab data
            const githubEvents = githubData.events || [];
            const gitlabEvents = gitlabData.events || [];
            
            const allDates = new Set();
            const githubDaily = {};
            const gitlabDaily = {};

            githubEvents.forEach(event => {
                const date = new Date(event.created_at).toDateString();
                allDates.add(date);
                githubDaily[date] = (githubDaily[date] || 0) + 1;
            });

            gitlabEvents.forEach(event => {
                const date = new Date(event.created_at).toDateString();
                allDates.add(date);
                gitlabDaily[date] = (gitlabDaily[date] || 0) + 1;
            });

            const sortedDates = Array.from(allDates).sort((a, b) => new Date(a) - new Date(b)).slice(-14);
            
            if (charts.combined) {
                charts.combined.destroy();
            }

            charts.combined = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedDates.map(date => new Date(date).toLocaleDateString()),
                    datasets: [{
                        label: 'GitHub',
                        data: sortedDates.map(date => githubDaily[date] || 0),
                        borderColor: '#333',
                        backgroundColor: 'rgba(51, 51, 51, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'GitLab',
                        data: sortedDates.map(date => gitlabDaily[date] || 0),
                        borderColor: '#FC6D26',
                        backgroundColor: 'rgba(252, 109, 38, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createActivityHeatmap() {
            const container = document.getElementById('activityHeatmap');
            const days = 49; // 7 weeks
            
            // Calculate activity for last 49 days
            const today = new Date();
            const heatmapData = [];
            
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                
                const githubActivity = githubData.events?.filter(event => 
                    new Date(event.created_at).toDateString() === dateStr
                ).length || 0;
                
                const gitlabActivity = gitlabData.events?.filter(event => 
                    new Date(event.created_at).toDateString() === dateStr
                ).length || 0;
                
                const totalActivity = githubActivity + gitlabActivity;
                heatmapData.push(totalActivity);
            }
            
            container.innerHTML = heatmapData.map(activity => {
                let className = 'heatmap-day';
                if (activity > 0) className += ' active-1';
                if (activity > 2) className += ' active-2';
                if (activity > 5) className += ' active-3';
                if (activity > 10) className += ' active-4';
                
                return `<div class="${className}" title="${activity} activities"></div>`;
            }).join('');
        }

        function showError(message) {
            const existingError = document.querySelector('.error');
            if (existingError) {
                existingError.remove();
            }
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.querySelector('.config-section').appendChild(errorDiv);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        // Initialize with sample data for demonstration
        document.addEventListener('DOMContentLoaded', function() {
            // You
