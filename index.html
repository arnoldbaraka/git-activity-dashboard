<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safaricom AI GitLab Analytics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --safaricom-green: #00A86B;
            --safaricom-dark-green: #008556;
            --safaricom-light-green: #40E0D0;
            --safaricom-neon: #00FF88;
            --dark-bg: #0A0E1A;
            --card-bg: rgba(0, 168, 107, 0.05);
            --glass-bg: rgba(255, 255, 255, 0.02);
            --border-glow: rgba(0, 255, 136, 0.3);
            --text-primary: #E8F5E8;
            --text-secondary: #B8E6C1;
            --shadow-glow: 0 0 30px rgba(0, 255, 136, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0A0E1A 0%, #1A2332 25%, #0D1B2A 50%, #0A1628 75%, #0A0E1A 100%);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
        }

        /* Animated background particles */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(0, 255, 136, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(0, 168, 107, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(64, 224, 208, 0.05) 0%, transparent 50%);
            animation: backgroundPulse 8s ease-in-out infinite alternate;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes backgroundPulse {
            0% { opacity: 0.3; }
            100% { opacity: 0.7; }
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            border: 1px solid var(--border-glow);
            box-shadow: var(--shadow-glow), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, var(--safaricom-neon), transparent);
            animation: rotate 20s linear infinite;
            opacity: 0.1;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .ai-logo {
            display: inline-block;
            margin-bottom: 20px;
            position: relative;
            animation: logoFloat 6s ease-in-out infinite;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-10px) scale(1.05); }
        }

        .ai-logo svg {
            width: 80px;
            height: 80px;
            filter: drop-shadow(0 0 20px var(--safaricom-neon));
        }

        .header h1 {
            color: var(--text-primary);
            font-size: 3rem;
            margin-bottom: 10px;
            font-weight: 800;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            background: linear-gradient(45deg, var(--safaricom-green), var(--safaricom-neon));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }

        .header .subtitle {
            color: var(--text-secondary);
            font-size: 1.2rem;
            font-weight: 400;
            position: relative;
            z-index: 1;
        }

        .config-section {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border-glow);
            box-shadow: var(--shadow-glow), inset 0 1px 0 rgba(255, 255, 255, 0.05);
            position: relative;
        }

        .config-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--safaricom-neon), transparent);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .config-section h2 {
            margin-bottom: 25px;
            color: var(--safaricom-neon);
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input[type="text"], input[type="url"] {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid rgba(0, 255, 136, 0.2);
            border-radius: 12px;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.3);
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        input[type="text"]:focus, input[type="url"]:focus {
            outline: none;
            border-color: var(--safaricom-neon);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
            background: rgba(0, 0, 0, 0.5);
        }

        .btn {
            background: linear-gradient(45deg, var(--safaricom-green), var(--safaricom-neon));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 15px;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            margin-top: 20px;
            padding: 15px 20px;
            border-radius: 12px;
            font-weight: 500;
            border: 1px solid;
            backdrop-filter: blur(10px);
        }

        .status.success {
            background: rgba(0, 255, 136, 0.1);
            color: var(--safaricom-neon);
            border-color: rgba(0, 255, 136, 0.3);
        }

        .status.error {
            background: rgba(255, 64, 64, 0.1);
            color: #FF6B6B;
            border-color: rgba(255, 64, 64, 0.3);
        }

        .status.loading {
            background: rgba(64, 224, 208, 0.1);
            color: var(--safaricom-light-green);
            border-color: rgba(64, 224, 208, 0.3);
        }

        .dashboard {
            display: none;
            animation: dashboardAppear 0.8s ease-out;
        }

        .dashboard.active {
            display: block;
        }

        @keyframes dashboardAppear {
            from { 
                opacity: 0; 
                transform: translateY(30px) scale(0.95);
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1);
            }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            border: 1px solid var(--border-glow);
            box-shadow: var(--shadow-glow);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--safaricom-green), var(--safaricom-neon), var(--safaricom-light-green));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: var(--safaricom-neon);
            box-shadow: 0 20px 40px rgba(0, 255, 136, 0.2);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(45deg, var(--safaricom-green), var(--safaricom-neon));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            animation: numberGlow 2s ease-in-out infinite alternate;
        }

        @keyframes numberGlow {
            0% { filter: drop-shadow(0 0 5px rgba(0, 255, 136, 0.3)); }
            100% { filter: drop-shadow(0 0 15px rgba(0, 255, 136, 0.6)); }
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 500;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .chart-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--border-glow);
            box-shadow: var(--shadow-glow);
            transition: all 0.3s ease;
            position: relative;
        }

        .chart-card:hover {
            transform: translateY(-5px);
            border-color: var(--safaricom-neon);
        }

        .chart-card h3 {
            margin-bottom: 25px;
            color: var(--safaricom-neon);
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .activity-list {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--border-glow);
            box-shadow: var(--shadow-glow);
        }

        .activity-list h3 {
            margin-bottom: 25px;
            color: var(--safaricom-neon);
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .activity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(0, 255, 136, 0.1);
            transition: all 0.3s ease;
        }

        .activity-item:hover {
            background: rgba(0, 255, 136, 0.05);
            border-radius: 10px;
            padding-left: 15px;
            padding-right: 15px;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-info {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .activity-meta {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .activity-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .badge-push {
            background: linear-gradient(45deg, var(--safaricom-green), var(--safaricom-neon));
            color: white;
        }

        .badge-merge {
            background: linear-gradient(45deg, var(--safaricom-light-green), #40E0D0);
            color: white;
        }

        .badge-issue {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
        }

        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--safaricom-green), var(--safaricom-neon));
            color: white;
            border: none;
            cursor: pointer;
            font-size: 24px;
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.4);
            transition: all 0.4s ease;
            z-index: 1000;
        }

        .refresh-btn:hover {
            transform: scale(1.1) rotate(180deg);
            box-shadow: 0 15px 40px rgba(0, 255, 136, 0.6);
        }

        .pulse-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            border: 2px solid var(--safaricom-neon);
            border-radius: 50%;
            animation: pulseRing 2s ease-out infinite;
            opacity: 0;
        }

        @keyframes pulseRing {
            0% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.4);
                opacity: 0;
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 50%;
            border-top-color: var(--safaricom-neon);
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .container {
                padding: 15px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, var(--safaricom-green), var(--safaricom-neon));
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, var(--safaricom-neon), var(--safaricom-light-green));
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="ai-logo">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <!-- AI Brain/Circuit Design -->
                    <defs>
                        <linearGradient id="brainGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#00A86B"/>
                            <stop offset="50%" style="stop-color:#00FF88"/>
                            <stop offset="100%" style="stop-color:#40E0D0"/>
                        </linearGradient>
                        <filter id="glow">
                            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                            <feMerge> 
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    
                    <!-- Main AI Brain Shape -->
                    <path d="M50 15 C25 15, 15 30, 15 45 C15 60, 20 70, 30 75 C35 80, 45 85, 50 85 C55 85, 65 80, 70 75 C80 70, 85 60, 85 45 C85 30, 75 15, 50 15 Z" 
                          fill="url(#brainGradient)" stroke="#00FF88" stroke-width="1" filter="url(#glow)"/>
                    
                    <!-- Neural Network Nodes -->
                    <circle cx="35" cy="35" r="3" fill="#00FF88" filter="url(#glow)">
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="50" cy="30" r="3" fill="#40E0D0" filter="url(#glow)">
                        <animate attributeName="opacity" values="1;0.5;1" dur="2.5s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="65" cy="35" r="3" fill="#00FF88" filter="url(#glow)">
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="1.8s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="40" cy="50" r="3" fill="#40E0D0" filter="url(#glow)">
                        <animate attributeName="opacity" values="1;0.5;1" dur="2.2s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="60" cy="50" r="3" fill="#00FF88" filter="url(#glow)">
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2.8s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="50" cy="65" r="3" fill="#40E0D0" filter="url(#glow)">
                        <animate attributeName="opacity" values="1;0.5;1" dur="2.1s" repeatCount="indefinite"/>
                    </circle>
                    
                    <!-- Neural Connections -->
                    <line x1="35" y1="35" x2="50" y2="30" stroke="#00FF88" stroke-width="1" opacity="0.6">
                        <animate attributeName="opacity" values="0.3;0.8;0.3" dur="3s" repeatCount="indefinite"/>
                    </line>
                    <line x1="50" y1="30" x2="65" y2="35" stroke="#40E0D0" stroke-width="1" opacity="0.6">
                        <animate attributeName="opacity" values="0.8;0.3;0.8" dur="2.5s" repeatCount="indefinite"/>
                    </line>
                    <line x1="40" y1="50" x2="60" y2="50" stroke="#00FF88" stroke-width="1" opacity="0.6">
                        <animate attributeName="opacity" values="0.3;0.8;0.3" dur="2.8s" repeatCount="indefinite"/>
                    </line>
                    <line x1="35" y1="35" x2="40" y2="50" stroke="#40E0D0" stroke-width="1" opacity="0.6">
                        <animate attributeName="opacity" values="0.8;0.3;0.8" dur="2.2s" repeatCount="indefinite"/>
                    </line>
                    <line x1="65" y1="35" x2="60" y2="50" stroke="#00FF88" stroke-width="1" opacity="0.6">
                        <animate attributeName="opacity" values="0.3;0.8;0.3" dur="2.6s" repeatCount="indefinite"/>
                    </line>
                    <line x1="50" y1="65" x2="40" y2="50" stroke="#40E0D0" stroke-width="1" opacity="0.6">
                        <animate attributeName="opacity" values="0.8;0.3;0.8" dur="2.4s" repeatCount="indefinite"/>
                    </line>
                    <line x1="50" y1="65" x2="60" y2="50" stroke="#00FF88" stroke-width="1" opacity="0.6">
                        <animate attributeName="opacity" values="0.3;0.8;0.3" dur="2.7s" repeatCount="indefinite"/>
                    </line>
                </svg>
            </div>
            <h1>Safaricom AI Analytics</h1>
            <p class="subtitle">Intelligent GitLab Insights Powered by Advanced Analytics</p>
        </div>

        <div class="config-section">
            <h2>⚡ Neural Network Configuration</h2>
            <div class="form-group">
                <label for="gitlabUrl">GitLab Instance URL:</label>
                <input type="url" id="gitlabUrl" placeholder="https://gitlab.com" value="https://gitlab.com">
            </div>
            <div class="form-group">
                <label for="accessToken">Personal Access Token:</label>
                <input type="text" id="accessToken" placeholder="glpat-xxxxxxxxxxxxxxxxxxxx">
            </div>
            <div class="form-group">
                <label for="projectId">Project ID (Optional - AI will analyze all projects if empty):</label>
                <input type="text" id="projectId" placeholder="123456">
            </div>
            <button class="btn" onclick="loadDashboard()">🚀 Initialize AI Dashboard</button>
            <button class="btn" onclick="testConnection()">🔍 Test Neural Link</button>
            <div id="status"></div>
        </div>

        <div id="dashboard" class="dashboard">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalProjects">-</div>
                    <div class="stat-label">AI-Tracked Projects</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalCommits">-</div>
                    <div class="stat-label">Neural Commits</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalIssues">-</div>
                    <div class="stat-label">Smart Issues</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalMergeRequests">-</div>
                    <div class="stat-label">Merge Intelligence</div>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-card">
                    <h3>📈 AI Commit Analysis</h3>
                    <canvas id="commitsChart" width="400" height="200"></canvas>
                </div>
                <div class="chart-card">
                    <h3>🧠 Language Intelligence</h3>
                    <canvas id="languagesChart" width="400" height="200"></canvas>
                </div>
                <div class="chart-card">
                    <h3>⚡ Neural Activity Patterns</h3>
                    <canvas id="activityChart" width="400" height="200"></canvas>
                </div>
                <div class="chart-card">
                    <h3>🎯 Smart Issue Tracking</h3>
                    <canvas id="issuesChart" width="400" height="200"></canvas>
                </div>
            </div>

            <div class="activity-list">
                <h3>🤖 AI-Powered Recent Activities</h3>
                <div id="recentActivities"></div>
            </div>
        </div>
    </div>

    <button class="refresh-btn" onclick="refreshData()" title="Refresh AI Data">
        🔄
        <div class="pulse-ring"></div>
    </button>

    <script>
        let gitlabApi;
        let dashboardData = {};
        let charts = {};

        // Safaricom color scheme for charts
        const safaricomColors = {
            primary: '#00A86B',
            secondary: '#00FF88',
            tertiary: '#40E0D0',
            accent: '#008556',
            gradient: ['#00A86B', '#00FF88', '#40E0D0', '#20B2AA', '#00CED1']
        };

        class GitLabAPI {
            constructor(baseUrl, token) {
                this.baseUrl = baseUrl.replace(/\/$/, '');
                this.token = token;
                this.headers = {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                };
            }

            async makeRequest(endpoint) {
                try {
                    const response = await fetch(`${this.baseUrl}/api/v4${endpoint}`, {
                        headers: this.headers,
                        mode: 'cors'
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('API Request failed:', error);
                    throw error;
                }
            }

            async getCurrentUser() {
                return await this.makeRequest('/user');
            }

            async getUserProjects(userId) {
                return await this.makeRequest(`/users/${userId}/projects?per_page=100&order_by=updated_at`);
            }

            async getProjectCommits(projectId, since = null) {
                const sinceParam = since ? `&since=${since}` : '';
                return await this.makeRequest(`/projects/${projectId}/repository/commits?per_page=100${sinceParam}`);
            }
            
            async getProjectIssues(projectId) {
                return await this.makeRequest(`/projects/${projectId}/issues?per_page=100&state=all`);
            }
            
            async getProjectMergeRequests(projectId) {
                return await this.makeRequest(`/projects/${projectId}/merge_requests?per_page=100&state=all`);
            }
            
            async getProjectLanguages(projectId) {
                return await this.makeRequest(`/projects/${projectId}/languages`);
            }
            
            async getProject(projectId) {
                return await this.makeRequest(`/projects/${projectId}`);
            }
            
            async getProjectStatistics(projectId) {
                return await this.makeRequest(`/projects/${projectId}/statistics`);
            }
        }

        function showStatus(message, type = 'loading') {
            const statusDiv = document.getElementById('status');
            const spinner = type === 'loading' ? '<span class="loading-spinner"></span>' : '';
            statusDiv.innerHTML = `<div class="status ${type}">${spinner}${message}</div>`;
        }

        function clearStatus() {
            document.getElementById('status').innerHTML = '';
        }

        async function testConnection() {
            const gitlabUrl = document.getElementById('gitlabUrl').value.trim();
            const accessToken = document.getElementById('accessToken').value.trim();
            
            if (!gitlabUrl || !accessToken) {
                showStatus('⚠️ Please enter both GitLab URL and Access Token', 'error');
                return;
            }
            
            try {
                showStatus('🔍 Testing neural link to GitLab...', 'loading');
                gitlabApi = new GitLabAPI(gitlabUrl, accessToken);
                
                const user = await gitlabApi.getCurrentUser();
                showStatus(`✅ Neural connection established! Welcome, ${user.name} (@${user.username})`, 'success');
                
                setTimeout(clearStatus, 5000);
            } catch (error) {
                showStatus(`❌ Neural link failed: ${error.message}`, 'error');
            }
        }

        async function loadDashboard() {
            const gitlabUrl = document.getElementById('gitlabUrl').value.trim();
            const accessToken = document.getElementById('accessToken').value.trim();
            const projectId = document.getElementById('projectId').value.trim();
            
            if (!gitlabUrl || !accessToken) {
                showStatus('⚠️ Please configure GitLab URL and Access Token first', 'error');
                return;
            }
            
            try {
                showStatus('🧠 AI is analyzing your GitLab data...', 'loading');
                gitlabApi = new GitLabAPI(gitlabUrl, accessToken);
                
                // Get current user
                const user = await gitlabApi.getCurrentUser();
                
                let projects = [];
                if (projectId) {
                    // Single project mode
                    const project = await gitlabApi.getProject(projectId);
                    projects = [project];
                } else {
                    // All user projects mode
                    projects = await gitlabApi.getUserProjects(user.id);
                }
                
                dashboardData = {
                    user: user,
                    projects: projects,
                    totalCommits: 0,
                    totalIssues: 0,
                    totalMergeRequests: 0,
                    languages: {},
                    commitsByDate: {},
                    recentActivities: []
                };
                
                // Analyze each project
                for (const project of projects.slice(0, 10)) { // Limit to first 10 projects for performance
                    try {
                        // Get commits from last 30 days
                        const thirtyDaysAgo = new Date();
                        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                        const commits = await gitlabApi.getProjectCommits(project.id, thirtyDaysAgo.toISOString());
                        
                        // Get issues
                        const issues = await gitlabApi.getProjectIssues(project.id);
                        
                        // Get merge requests
                        const mergeRequests = await gitlabApi.getProjectMergeRequests(project.id);
                        
                        // Get languages
                        const languages = await gitlabApi.getProjectLanguages(project.id);
                        
                        // Aggregate data
                        dashboardData.totalCommits += commits.length;
                        dashboardData.totalIssues += issues.length;
                        dashboardData.totalMergeRequests += mergeRequests.length;
                        
                        // Process commits by date
                        commits.forEach(commit => {
                            const date = new Date(commit.committed_date).toDateString();
                            dashboardData.commitsByDate[date] = (dashboardData.commitsByDate[date] || 0) + 1;
                            
                            // Add to recent activities
                            dashboardData.recentActivities.push({
                                type: 'commit',
                                message: commit.message.split('\n')[0],
                                author: commit.author_name,
                                date: new Date(commit.committed_date),
                                project: project.name
                            });
                        });
                        
                        // Process languages
                        Object.keys(languages).forEach(lang => {
                            dashboardData.languages[lang] = (dashboardData.languages[lang] || 0) + languages[lang];
                        });
                        
                        // Add issues to recent activities
                        issues.slice(0, 5).forEach(issue => {
                            dashboardData.recentActivities.push({
                                type: 'issue',
                                message: issue.title,
                                author: issue.author.name,
                                date: new Date(issue.created_at),
                                project: project.name,
                                state: issue.state
                            });
                        });
                        
                        // Add merge requests to recent activities
                        mergeRequests.slice(0, 5).forEach(mr => {
                            dashboardData.recentActivities.push({
                                type: 'merge_request',
                                message: mr.title,
                                author: mr.author.name,
                                date: new Date(mr.created_at),
                                project: project.name,
                                state: mr.state
                            });
                        });
                        
                    } catch (error) {
                        console.warn(`Error analyzing project ${project.name}:`, error);
                    }
                }
                
                // Sort recent activities by date
                dashboardData.recentActivities.sort((a, b) => b.date - a.date);
                dashboardData.recentActivities = dashboardData.recentActivities.slice(0, 20);
                
                updateDashboardUI();
                showStatus('🚀 AI analysis complete! Dashboard loaded successfully.', 'success');
                setTimeout(clearStatus, 3000);
                
            } catch (error) {
                showStatus(`❌ AI analysis failed: ${error.message}`, 'error');
            }
        }

        function updateDashboardUI() {
            // Update stats
            document.getElementById('totalProjects').textContent = dashboardData.projects.length;
            document.getElementById('totalCommits').textContent = dashboardData.totalCommits.toLocaleString();
            document.getElementById('totalIssues').textContent = dashboardData.totalIssues.toLocaleString();
            document.getElementById('totalMergeRequests').textContent = dashboardData.totalMergeRequests.toLocaleString();
            
            // Show dashboard
            document.getElementById('dashboard').classList.add('active');
            
            // Create charts
            createCommitsChart();
            createLanguagesChart();
            createActivityChart();
            createIssuesChart();
            
            // Update recent activities
            updateRecentActivities();
        }

        function createCommitsChart() {
            const ctx = document.getElementById('commitsChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (charts.commits) {
                charts.commits.destroy();
            }
            
            const dates = Object.keys(dashboardData.commitsByDate).sort();
            const commits = dates.map(date => dashboardData.commitsByDate[date]);
            
            charts.commits = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates.map(date => new Date(date).toLocaleDateString()),
                    datasets: [{
                        label: 'Commits',
                        data: commits,
                        borderColor: safaricomColors.primary,
                        backgroundColor: `${safaricomColors.primary}20`,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: safaricomColors.secondary,
                        pointBorderColor: safaricomColors.primary,
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#E8F5E8'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#B8E6C1'
                            },
                            grid: {
                                color: 'rgba(0, 255, 136, 0.1)'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#B8E6C1'
                            },
                            grid: {
                                color: 'rgba(0, 255, 136, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        function createLanguagesChart() {
            const ctx = document.getElementById('languagesChart').getContext('2d');
            
            if (charts.languages) {
                charts.languages.destroy();
            }
            
            const languages = Object.keys(dashboardData.languages);
            const values = Object.values(dashboardData.languages);
            
            charts.languages = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: languages,
                    datasets: [{
                        data: values,
                        backgroundColor: safaricomColors.gradient,
                        borderColor: '#0A0E1A',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#E8F5E8',
                                padding: 20
                            }
                        }
                    }
                }
            });
        }

        function createActivityChart() {
            const ctx = document.getElementById('activityChart').getContext('2d');
            
            if (charts.activity) {
                charts.activity.destroy();
            }
            
            // Group activities by type
            const activityTypes = {
                commit: 0,
                issue: 0,
                merge_request: 0
            };
            
            dashboardData.recentActivities.forEach(activity => {
                activityTypes[activity.type]++;
            });
            
            charts.activity = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Commits', 'Issues', 'Merge Requests'],
                    datasets: [{
                        label: 'Activities',
                        data: [activityTypes.commit, activityTypes.issue, activityTypes.merge_request],
                        backgroundColor: [
                            safaricomColors.primary,
                            safaricomColors.secondary,
                            safaricomColors.tertiary
                        ],
                        borderColor: [
                            safaricomColors.accent,
                            safaricomColors.primary,
                            safaricomColors.secondary
                        ],
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#B8E6C1'
                            },
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            ticks: {
                                color: '#B8E6C1'
                            },
                            grid: {
                                color: 'rgba(0, 255, 136, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        function createIssuesChart() {
            const ctx = document.getElementById('issuesChart').getContext('2d');
            
            if (charts.issues) {
                charts.issues.destroy();
            }
            
            // Count issues by state
            const issueStates = {
                opened: 0,
                closed: 0
            };
            
            dashboardData.recentActivities.forEach(activity => {
                if (activity.type === 'issue') {
                    issueStates[activity.state] = (issueStates[activity.state] || 0) + 1;
                }
            });
            
            charts.issues = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Open Issues', 'Closed Issues'],
                    datasets: [{
                        data: [issueStates.opened || 0, issueStates.closed || 0],
                        backgroundColor: [safaricomColors.secondary, safaricomColors.primary],
                        borderColor: '#0A0E1A',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#E8F5E8',
                                padding: 20
                            }
                        }
                    }
                }
            });
        }

        function updateRecentActivities() {
            const container = document.getElementById('recentActivities');
            
            if (dashboardData.recentActivities.length === 0) {
                container.innerHTML = '<div class="activity-item"><div class="activity-info"><div class="activity-title">No recent activities found</div></div></div>';
                return;
            }
            
            container.innerHTML = dashboardData.recentActivities.map(activity => {
                const badge = activity.type === 'commit' ? 'badge-push' : 
                             activity.type === 'issue' ? 'badge-issue' : 'badge-merge';
                const icon = activity.type === 'commit' ? '📝' :
                            activity.type === 'issue' ? '🐛' : '🔀';
                
                return `
                    <div class="activity-item">
                        <div class="activity-info">
                            <div class="activity-title">${activity.message}</div>
                            <div class="activity-meta">
                                ${activity.author} • ${activity.project} • ${activity.date.toLocaleDateString()}
                            </div>
                        </div>
                        <div class="activity-badge ${badge}">
                            ${icon} ${activity.type.replace('_', ' ')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function refreshData() {
            if (!gitlabApi) {
                showStatus('⚠️ Please initialize the dashboard first', 'error');
                return;
            }
            
            showStatus('🔄 AI is refreshing data...', 'loading');
            await loadDashboard();
        }

        // Auto-refresh every 5 minutes
        setInterval(() => {
            if (gitlabApi && document.getElementById('dashboard').classList.contains('active')) {
                refreshData();
            }
        }, 300000);

        // Initialize tooltips and animations
        document.addEventListener('DOMContentLoaded', function() {
            // Add hover effects to stat cards
            const statCards = document.querySelectorAll('.stat-card');
            statCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-8px) scale(1.02)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });
        });
    </script>
</body>
</html>
